{"version":3,"sources":["../src/chrome/internalSourceBreakpoint.ts"],"names":[],"mappings":";AAAA;;4DAE4D;;AAK5D;IAQI,YAAY,UAA0C;QAClD,IAAI,CAAC,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC;QAC5B,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;QAChC,IAAI,CAAC,YAAY,GAAG,UAAU,CAAC,YAAY,CAAC;QAE5C,EAAE,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC;YACxB,IAAI,CAAC,SAAS,GAAG,sBAAsB,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;YAC/D,EAAE,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC;gBACvB,IAAI,CAAC,SAAS,GAAG,IAAI,UAAU,CAAC,SAAS,QAAQ,IAAI,CAAC,SAAS,EAAE,CAAC;YACtE,CAAC;QACL,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC;YAC9B,IAAI,CAAC,SAAS,GAAG,UAAU,CAAC,SAAS,CAAC;QAC1C,CAAC;IACL,CAAC;;AApBe,qCAAY,GAAG,oBAAoB,CAAC;AADxD,4DAsBC;AAED,yBAAyB,UAA0C;IAC/D,MAAM,CAAC,UAAU,IAAI,UAAU,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,IAAI,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,wBAAwB,CAAC,YAAY,CAAC;AACpI,CAAC;AAED,wCAA+C,UAAmC;IAC9E,EAAE,CAAC,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAC9B,MAAM,mBACC,UAAU,IACb,UAAU,EAAE,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,IAC5C;IACN,CAAC;IAED,MAAM,CAAC,UAAU,CAAC;AACtB,CAAC;AATD,wEASC;AAED,MAAM,0BAA0B,GAAG,UAAU,CAAC;AAE9C,gCAAgC,GAAW;IACvC,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAE7B,MAAM,IAAI,GAAa,EAAE,CAAC;IAC1B,IAAI,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,0BAA0B,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;QAClE,MAAM,CAAC,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC;QACvB,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpB,MAAM,CAAC,IAAI,CAAC;QAChB,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,MAAM,CAAC,EAAE,CAAC;QACd,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAEtC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;IACzD,MAAM,CAAC,gBAAgB,MAAM,IAAI,MAAM,qBAAqB,wBAAwB,CAAC,YAAY,EAAE,CAAC;AACxG,CAAC","file":"internalSourceBreakpoint.js","sourcesContent":["/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\n\nimport { Protocol as Crdp } from 'devtools-protocol';\nimport { DebugProtocol } from 'vscode-debugprotocol';\n\nexport class InternalSourceBreakpoint {\n    static readonly LOGPOINT_URL = 'vscode.logpoint.js';\n\n    readonly line: number;\n    readonly column?: number;\n    readonly condition?: string;\n    readonly hitCondition?: string;\n\n    constructor(breakpoint: DebugProtocol.SourceBreakpoint) {\n        this.line = breakpoint.line;\n        this.column = breakpoint.column;\n        this.hitCondition = breakpoint.hitCondition;\n\n        if (breakpoint.logMessage) {\n            this.condition = logMessageToExpression(breakpoint.logMessage);\n            if (breakpoint.condition) {\n                this.condition = `(${breakpoint.condition}) && ${this.condition}`;\n            }\n        } else if (breakpoint.condition) {\n            this.condition = breakpoint.condition;\n        }\n    }\n}\n\nfunction isLogpointStack(stackTrace: Crdp.Runtime.StackTrace | null): boolean {\n    return stackTrace && stackTrace.callFrames.length > 0 && stackTrace.callFrames[0].url === InternalSourceBreakpoint.LOGPOINT_URL;\n}\n\nexport function stackTraceWithoutLogpointFrame(stackTrace: Crdp.Runtime.StackTrace): Crdp.Runtime.StackTrace {\n    if (isLogpointStack(stackTrace)) {\n        return {\n            ...stackTrace,\n            callFrames: stackTrace.callFrames.slice(1)\n        };\n    }\n\n    return stackTrace;\n}\n\nconst LOGMESSAGE_VARIABLE_REGEXP = /{(.*?)}/g;\n\nfunction logMessageToExpression(msg: string): string {\n    msg = msg.replace('%', '%%');\n\n    const args: string[] = [];\n    let format = msg.replace(LOGMESSAGE_VARIABLE_REGEXP, (match, group) => {\n        const a = group.trim();\n        if (a) {\n            args.push(`(${a})`);\n            return '%O';\n        } else {\n            return '';\n        }\n    });\n\n    format = format.replace('\\'', '\\\\\\'');\n\n    const argStr = args.length ? `, ${args.join(', ')}` : '';\n    return `console.log('${format}'${argStr});\\n//# sourceURL=${InternalSourceBreakpoint.LOGPOINT_URL}`;\n}\n"],"sourceRoot":"../.."}